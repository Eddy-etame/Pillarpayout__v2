version: '3.9'

services:
  postgres:
    image: postgres:16-alpine
    environment:
      POSTGRES_USER: pillar
      POSTGRES_PASSWORD: pillar
      POSTGRES_DB: pillar_core
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  mongo:
    image: mongo:7
    ports:
      - "27017:27017"
    volumes:
      - mongo_data:/data/db

  api-gateway:
    build: ../apps/api-gateway
    ports:
      - "3000:3000"

  auth:
    build: ../apps/auth
    environment:
      CRYPTO_SERVICE_URL: http://crypto:3000
      PEPPER1: dev-pepper1
    ports:
      - "3001:3000"

  crypto:
    build: ../apps/crypto
    environment:
      PEPPER2: dev-pepper2
    ports:
      - "3002:3000"

  user:
    build: ../apps/user
    ports:
      - "3003:3000"

  game:
    build: ../apps/game
    ports:
      - "3004:3000"

  wallet:
    build: ../apps/wallet
    ports:
      - "3005:3000"

  chat:
    build: ../apps/chat
    ports:
      - "3006:3000"

  admin-analytics:
    build: ../apps/admin-analytics
    ports:
      - "3007:3000"

  tournament:
    build: ../apps/tournament
    ports:
      - "3008:3000"

  notification:
    build: ../apps/notification
    ports:
      - "3009:3000"

  web:
    build: ../apps/web
    ports:
      - "4200:80"

volumes:
  postgres_data:
  mongo_data:
